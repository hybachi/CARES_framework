<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- Constants -->
  <xacro:property name="M_PI" value="3.1415926535897931"/>

  <!-- Robot mechanical and kinematic properties -->
  <xacro:property name="base_width" value="0.160"/>
  <xacro:property name="base_length" value="0.178"/>
  <xacro:property name="wheel_radius" value="0.033"/>
  <xacro:property name="wheel_width" value="0.018"/>
  <xacro:property name="wheel_separation" value="0.160"/>
  <xacro:property name="wheel_joint_offset" value="0.080"/>

  <xacro:macro name="tb3_core" params="">

    <!-- Base link -->
    <link name="base_footprint"/>

    <link name="base_link">
      <visual>
        <origin xyz="-0.032 0 0.0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://robot_description/models/turtlebot3_common/meshes/burger_base.dae"
                scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="dark"/>
      </visual>

      <collision>
        <origin xyz="-0.032 0 0.070" rpy="0 0 0"/>
        <geometry>
          <box size="0.140 0.140 0.143"/>
        </geometry>
      </collision>

      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="8.2573504e-01"/>
        <inertia ixx="2.2124416e-03" ixy="-1.2294101e-05" ixz="3.4938785e-05"
                 iyy="2.1193702e-03" iyz="-5.0120904e-06"
                 izz="2.0064271e-03" />
      </inertial>
    </link>

    <joint name="base_joint" type="fixed">
      <parent link="base_footprint"/>
      <child link="base_link"/>
      <origin xyz="0.0 0.0 0.010" rpy="0 0 0"/>
    </joint>

    <!-- Wheels -->
    <xacro:macro name="wheel" params="prefix reflect">
      <link name="wheel_${prefix}_link">
        <visual>
          <origin xyz="0 0 0" rpy="${M_PI/2} 0 0"/>
          <geometry>
            <mesh filename="package://robot_description/models/turtlebot3_common/meshes/tire.dae"
                  scale="0.001 0.001 0.001"/>
          </geometry>
          <material name="dark"/>
        </visual>

        <collision>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <cylinder length="${wheel_width}" radius="${wheel_radius}"/>
          </geometry>
        </collision>

        <inertial>
          <origin xyz="0 0 0" />
          <mass value="2.8498940e-02" />
          <inertia ixx="1.1175580e-05" ixy="-4.2369783e-11" ixz="-5.9381719e-09"
                   iyy="1.1192413e-05" iyz="-1.4400107e-11"
                   izz="2.0712558e-05" />
        </inertial>
      </link>

      <joint name="wheel_${prefix}_joint" type="continuous">
        <parent link="base_link"/>
        <child link="wheel_${prefix}_link"/>
        <origin xyz="0 ${reflect*wheel_joint_offset} 0.023" rpy="-${M_PI/2} 0 0"/>
        <axis xyz="0 0 1"/>
      </joint>
    </xacro:macro>

    <xacro:wheel prefix="left"  reflect="1"/>
    <xacro:wheel prefix="right" reflect="-1"/>

    <!-- Caster wheel -->
    <link name="caster_back_link">
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <sphere radius="0.005"/>
        </geometry>
      </collision>

      <inertial>
        <origin xyz="0 0 0" />
        <mass value="0.005" />
        <inertia ixx="0.001" ixy="0.0" ixz="0.0"
                 iyy="0.001" iyz="0.0"
                 izz="0.001" />
      </inertial>
    </link>

    <joint name="caster_back_joint" type="fixed">
      <parent link="base_link"/>
      <child link="caster_back_link"/>
      <origin xyz="-0.081 0 -0.004" rpy="-${M_PI/2} 0 0"/>
    </joint>

  </xacro:macro>

</robot>
